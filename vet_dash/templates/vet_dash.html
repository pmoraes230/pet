{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="bg-gray-50 flex min-h-screen">

    <!-- Sidebar -->
    {% include "partials/aside/aside_vet.html" %}

    <main class="flex-1 flex flex-col overflow-hidden">

        <!-- Header -->
        {% include "partials/header/header_vet.html" %}

        <!-- Conteúdo -->
        <div class="flex-1 overflow-y-auto p-6 md:p-10 space-y-8">

            <!-- ESTATÍSTICAS -->
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
                
                <!-- Pacientes -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="bg-blue-100 w-10 h-10 flex items-center justify-center rounded-lg text-blue-600 mb-4">
                        <i data-lucide="users" width="20" height="20"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800">{{ total_pacientes }}</div>
                    <div class="text-xs text-gray-400">Total Pacientes</div>
                </div>

                <!-- Consultas -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="bg-purple-100 w-10 h-10 flex items-center justify-center rounded-lg text-purple-600 mb-4">
                        <i data-lucide="calendar" width="20" height="20"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800">{{ consultas_hoje }}</div>
                    <div class="text-xs text-gray-400">Consultas Hoje</div>
                </div>

                <!-- Críticos -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="bg-yellow-100 w-10 h-10 flex items-center justify-center rounded-lg text-yellow-600 mb-4">
                        <i data-lucide="activity" width="20" height="20"></i>
                    </div>
                    <div class="text-2xl font-bold text-gray-800">{{ casos_criticos }}</div>
                    <div class="text-xs text-gray-400">Casos Críticos</div>
                </div>

                <!-- Faturamento -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <div class="bg-green-100 w-10 h-10 flex items-center justify-center rounded-lg text-green-600 mb-4">
                        <i data-lucide="dollar-sign" width="20" height="20"></i>
                    </div>
                    <!-- Floatformat:2 garante R$ 100,00 -->
                    <div class="text-2xl font-bold text-gray-800">R$ {{ faturamento_dia|floatformat:2 }}</div>
                    <div class="text-xs text-gray-400">Faturamento Hoje</div>
                </div>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- AGENDA -->
                <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-gray-100">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Agenda de Hoje</h2>
                    <div class="divide-y divide-gray-100">
                        {% for consulta in agenda_hoje %}
                        <a href="#" class="block p-4 flex items-center gap-4 hover:bg-gray-50 transition-colors rounded-lg group">
                            
                            <div class="text-center w-16 flex-shrink-0 bg-gray-50 rounded-lg py-2 group-hover:bg-white border border-transparent group-hover:border-gray-200">
                                <div class="text-sm font-bold text-gray-800">{{ consulta.horario_consulta|date:"H:i" }}</div>
                            </div>
                            
                            <div class="flex-1 min-w-0">
                                <div class="font-bold text-gray-800 truncate">{{ consulta.id_pet.nome }}</div>
                                <div class="text-xs text-gray-500 truncate">
                                    {{ consulta.tipo_de_consulta }} • Tutor: {{ consulta.id_pet.id_tutor.nome_tutor }}
                                </div>
                            </div>

                            <!-- BADGES DE STATUS (Agora usando o campo real do banco) -->
                            {% if consulta.status == 'Confirmado' %}
                                <span class="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">Confirmado</span>
                            {% elif consulta.status == 'Agendado' %}
                                <span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold">Agendado</span>
                            {% elif consulta.status == 'Cancelado' %}
                                <span class="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold">Cancelado</span>
                            {% elif consulta.status == 'Concluido' %}
                                <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold">Concluído</span>
                            {% else %}
                                <!-- Caso venha algo diferente, mostra o texto cru -->
                                <span class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs font-bold">{{ consulta.status }}</span>
                            {% endif %}
                        </a>
                        {% empty %}
                        <div class="text-center py-12">
                            <i data-lucide="coffee" class="mx-auto mb-3 text-gray-300" width="30"></i>
                            <p class="text-gray-400 text-sm">Nenhuma consulta agendada para hoje.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- ALERTAS -->
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-gray-100 h-fit">
                    <h2 class="text-xl font-bold text-gray-800 mb-6">Alertas</h2>
                    <div class="space-y-3">
                        {% for alerta in alertas %}
                        <div class="flex gap-3 items-start p-3 rounded-xl bg-red-50 border border-red-100">
                            <div class="bg-white text-red-500 p-2 rounded-full shadow-sm shrink-0">
                                <i data-lucide="alert-circle" width="16" height="16"></i>
                            </div>
                            <div>
                                <div class="text-sm font-bold text-gray-800">{{ alerta.id_pet.nome }}</div>
                                <div class="text-xs text-red-600 font-medium">{{ alerta.tipo_de_consulta }}</div>
                            </div>
                        </div>
                        {% empty %}
                        <div class="text-center py-6 text-gray-400">
                            <p class="text-sm">Nenhum alerta pendente.</p>
                        </div>
                        {% endfor %}
                    </div>
                </div>

            </div>
        </div>
    </main>
</div>

<script>
    lucide.createIcons();
</script>
{% endblock %}