{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="bg-gray-50 flex flex-col md:flex-row h-screen overflow-hidden">

    {% include "partials/aside/aside_tutor.html" %}

    <main class="flex-1 flex flex-col h-screen overflow-hidden">
        {% include "partials/header/header_tutor.html" %}

        <div class="flex-1 overflow-y-auto p-6 md:p-10 pb-32">

            <div class="max-w-6xl mx-auto">
                
                <!-- CABE√áALHO DA P√ÅGINA -->
                <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-10">
                    <div>
                        <h1 class="text-3xl font-black text-gray-800">Meus pets</h1>
                        <p class="text-gray-500 font-medium">Gerencie as informa√ß√µes de todos os seus amigos.</p>
                    </div>

                    <!-- BOT√ÉO ADICIONAR NO TOPO -->
                    <a href="{% url 'adicionar_pet' %}"
                       class="bg-[#DCD0FF] hover:bg-[#c9b9ff] text-purple-900 px-8 py-3 rounded-2xl font-black flex items-center justify-center gap-2 transition-all shadow-sm">
                        <span class="text-2xl">+</span> Adicionar pet
                    </a>
                </div>

                {% if pets %}
                    <!-- LISTA DE PETS EM GRID (UM AO LADO DO OUTRO) -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                        {% for pet in pets %}
                            <div class="group relative bg-white rounded-[2.5rem] shadow-sm border border-gray-100 hover:shadow-md transition-all duration-300">

                                <!-- Link que envolve o card -->
                                <a href="{% url 'detalhe_pet' pet.id %}" class="block p-6">
                                    <!-- Foto do Pet -->
                                    <div class="w-full h-44 rounded-[2rem] overflow-hidden mb-5 bg-gray-50">
                                        {% if pet.imagem %}
                                            <img src="{{ pet.imagem.url }}" class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500">
                                        {% else %}
                                            <img src="{% static 'images/default-pet.png' %}" class="w-full h-full object-cover opacity-50">
                                        {% endif %}
                                    </div>

                                    <div class="text-center">
                                        <h2 class="text-2xl font-black text-gray-800 mb-1">{{ pet.nome }}</h2>
                                        <p class="text-gray-400 font-bold uppercase text-[11px] tracking-widest">
                                            {{ pet.especie }} ‚Ä¢ {{ pet.raca }}
                                        </p>
                                        <div class="mt-4 inline-block px-4 py-1 bg-purple-50 text-purple-600 rounded-full text-xs font-black">
                                            {{ pet.idade }} anos
                                        </div>
                                    </div>
                                </a>

                                <!-- Menu de op√ß√µes (3 pontinhos) -->
                                <div class="absolute top-8 right-8">
                                    <button onclick="toggleMenu({{ pet.id }})" class="w-10 h-10 flex items-center justify-center rounded-xl bg-white/80 backdrop-blur-sm text-gray-500 hover:text-purple-600 shadow-sm transition-all">
                                        &#x22EE;
                                    </button>

                                    <!-- Menu oculto -->
                                    <div id="menu-{{ pet.id }}" class="hidden absolute right-0 mt-2 bg-white shadow-2xl border border-gray-50 rounded-2xl py-2 w-48 z-20">
                                        <a href="{% url 'detalhe_pet' pet.id %}" class="block px-6 py-3 text-gray-700 font-bold hover:bg-purple-50 transition-colors">
                                            ‚úèÔ∏è Ver detalhes
                                        </a>
                                        <button onclick="openModal({{ pet.id }}, '{{ pet.nome }}')"
                                                class="w-full text-left px-6 py-3 text-red-500 font-bold hover:bg-red-50 transition-colors border-t border-gray-50">
                                            üóëÔ∏è Excluir Pet
                                        </button>
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>

                    <!-- BOT√ÉO FLUTUANTE (OPCIONAL, J√Å TEM O NO TOPO) -->
                    <a href="{% url 'adicionar_pet' %}"
                       class="fixed bottom-10 right-10 bg-purple-600 hover:bg-purple-700 text-white w-16 h-16
                              flex items-center justify-center rounded-full text-4xl shadow-2xl transition-transform hover:scale-110 z-50">
                        +
                    </a>

                {% else %}
                    <!-- PRIMEIRO PET (QUANDO N√ÉO H√Å NENHUM) -->
                    <div class="bg-white rounded-[3rem] p-12 shadow-sm border border-gray-100 max-w-2xl mx-auto text-center mt-10">
                        <div class="text-6xl mb-6">üêæ</div>
                        <h2 class="text-3xl font-black text-gray-800 mb-4">
                            Sua fam√≠lia come√ßa aqui!
                        </h2>
                        <p class="text-gray-500 font-medium mb-10">Voc√™ ainda n√£o cadastrou nenhum pet. Vamos come√ßar adicionando seu primeiro amigo?</p>
                    </div>
                {% endif %}
            </div>

        </div>
    </main>
</div>

<!-- ================= MODAL DE CONFIRMA√á√ÉO ================= -->
<div id="deleteModal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-[2.5rem] p-10 max-w-md w-full shadow-2xl animate-in zoom-in-95 duration-200">
        <h2 class="text-2xl font-black text-gray-800 mb-4 text-center">Confirmar exclus√£o</h2>
        <p id="modalMessage" class="text-gray-500 font-medium mb-8 text-center">Tem certeza que deseja excluir este pet? Esta a√ß√£o n√£o pode ser desfeita.</p>
        <div class="flex gap-4">
            <button onclick="closeModal()"
                    class="flex-1 px-4 py-4 rounded-2xl bg-gray-100 text-gray-600 font-black hover:bg-gray-200 transition-colors">
                N√£o, manter
            </button>
            <a id="confirmDeleteBtn" href="#"
               class="flex-1 px-4 py-4 rounded-2xl bg-red-600 text-white font-black text-center hover:bg-red-700 transition-colors">
                Sim, excluir
            </a>
        </div>
    </div>
</div>

<script>
function toggleMenu(petId) {
    const menu = document.getElementById(`menu-${petId}`);
    // Fecha outros menus abertos primeiro
    document.querySelectorAll('[id^="menu-"]').forEach(m => {
        if(m.id !== `menu-${petId}`) m.classList.add('hidden');
    });
    menu.classList.toggle('hidden');
}

function openModal(petId, petNome) {
    const modal = document.getElementById('deleteModal');
    const confirmBtn = document.getElementById('confirmDeleteBtn');
    const message = document.getElementById('modalMessage');

    message.textContent = `Tem certeza que deseja excluir o pet "${petNome}"? Todos os dados vinculados a ele ser√£o perdidos!`;
    confirmBtn.href = "{% url 'excluir_pet' 0 %}".replace('0', petId);

    modal.classList.remove('hidden');
}

function closeModal() {
    document.getElementById('deleteModal').classList.add('hidden');
}

// Fecha menus ao clicar fora
document.addEventListener('click', function(event) {
    if (!event.target.closest('button')) {
        document.querySelectorAll('[id^="menu-"]').forEach(menu => {
            menu.classList.add('hidden');
        });
    }
});
</script>
{% endblock %}